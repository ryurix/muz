<?php

/*
$start = round(microtime(true) * 1000);

echo '<p>'.\Price\Cron::run(null).'</p>';

$finish = round(microtime(true) * 1000);

echo '<p>'.($finish - $start).'ms</p>';

/*
$rows = \Db::fetchAll('SELECT store,vendor,price,opt,count FROM sync,vendor WHERE sync.vendor=vendor.i AND sync.dt>('.\Config::now().'-vendor.days*86400) AND store IN ('.implode(',', $ids).')');
$sync = [];
foreach ($rows as $i) {
	$store = $i['store'];
	if (isset($sync[$store])) {
		$sync[$store][] = $i;
	} else {
		$sync[$store] = [$i];
	}
}
return $sync;
//*/

/*
$a = [];
$a[] = [
	'product_id'=>'123',
	'offer_id'=>'лю54321',
	'stock'=>321,
	'warehouse_id'=>123124,
]; // new OzonStock($k, $v);

$post = ['stocks'=>$a];

echo '<p>'.json_encode($post).'</p>';
echo '<p>'.json_encode($post, JSON_FORCE_OBJECT).'</p>';
echo '<p>'.\Flydom\Json::encode($post).'</p>';
echo '<p>'.\Flydom\Json::encode($post, 0, true).'</p>';
//*/

/*
$upd = [];
$q = \Db::select('SELECT s.i,s.price,s.opt,v.sopt FROM sync s LEFT JOIN vendor v ON s.vendor=v.i WHERE (s.opt IS NULL OR s.opt=0) AND s.price>0');

while ($row = \Db::fetch($q)) {
	$upd[$row['i']] = round($row['price'] * (100 - $row['sopt']) / 100);
}
\Db::free($q);

foreach ($upd as $k=>$v) {
	\Db::update('sync', ['opt'=>$v], ['i'=>$k]);
}

//*/